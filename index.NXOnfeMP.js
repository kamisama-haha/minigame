import{d as x,i as z,y as X,j as Y,r as C,c as $,o as c,a as d,e as i,k as L,C as U,b as o,l as F,n as Z,m as _,p as O,u as N,H as re,$ as ue,s as de,q as _e,w as E,t as j,F as q,D as pe,Z as J,K as ve,U as Q,v as ke,_ as W,a3 as me,a9 as fe,R as he}from"./entry.Dv1IsjD4.js";import{_ as ee}from"./Price.vue.Cny252bW.js";import{_ as se}from"./Preloader.vue.EL_BqhER.js";const be={class:"bs-content"},$e=["innerHTML"],Se={class:"bs-content-price"},Le=["innerHTML"],ye={class:"bs-content-buttons"},ge=["disabled"],Ce=["innerHTML"],Ne=["innerHTML"],Ae=x({__name:"BuySkin",props:{skin:{},image:{}},setup(B){const{$event:f}=_(),k=z(),S=X(),{t:y}=Y(),p=B,m=C(!1);let n;const t=$(()=>{var l;return(((l=p.skin)==null?void 0:l.price)??0)<=(k.balanceCoins??1)}),r=async()=>{t.value&&!m.value&&(m.value=!0,n=Z.promise({title:_().$i18n.t("messages.process_request")}),await k.postSkinBuy(p.skin.id).then(()=>{O().useHapticFeedback("heavy"),N().trackEvent(`skin_buy_success_${v.value}`),n==null||n.resolve({title:_().$i18n.t("messages.skin_success",{name:v.value}),duration:3e3}),f("buy-skin:success",{skin:p.skin}),f("bs:close")}).catch(l=>{var T;N().trackEvent(`skin_buy_error_${v.value}`);const A=(T=l==null?void 0:l.data)==null?void 0:T.error_code;if(A)switch(A){case"SKIN_CONFIG_NOT_FOUND":n==null||n.reject(_().$i18n.t("messages.SKIN_CONFIG_NOT_FOUND")),S.postConfig();break;case"SKIN_NOT_AVAILABLE":n==null||n.reject(_().$i18n.t("messages.SKIN_NOT_AVAILABLE")),S.postConfig();break;case"SKIN_ALREADY_AVAILABLE":n==null||n.reject(_().$i18n.t("messages.SKIN_ALREADY_AVAILABLE")),S.postConfig();break;case"INSUFFICIENT_FUNDS":n==null||n.reject(_().$i18n.t("messages.INSUFFICIENT_FUNDS")),k.postSync();break;default:n==null||n.reject(_().$i18n.t("messages.no_skin"));break}else n==null||n.reject(_().$i18n.t("messages.no_skin"))}).finally(()=>{setTimeout(()=>{m.value=!1},400)}))},h=()=>{N().trackEvent(`skin_buy_cancel_${v.value}`),f("bs:close")},v=$(()=>{var l;return((l=p.skin)==null?void 0:l.name)??"skin"}),b=$(()=>t.value?y("buttons.buy"):y("messages.not_enough_funds"));return(l,A)=>{const T=ee,M=se;return c(),d("div",be,[i("div",{class:"bs-content-title-medium has-top-gap",innerHTML:l.$t("profile.buy_skin",{name:l.skin.name??"skin"})},null,8,$e),i("div",Se,[i("p",{innerHTML:l.$t("messages.price")},null,8,Le),L(T,{price:l.skin.price,size:"large",class:U({"is-grayscale":!o(t)}),round:!1,text:l.skin.price>0?"":l.$t("messages.free")},null,8,["price","class","text"])]),i("div",ye,[i("button",{class:"button button-default button-primary",onClick:r,disabled:o(m)},[o(m)?(c(),F(M,{key:0})):(c(),d("span",{key:1,innerHTML:o(b)},null,8,Ce))],8,ge),i("button",{class:"button button-default button-dark",innerHTML:l.$t("buttons.cancel"),onClick:h},null,8,Ne)])])}}}),Te={class:"profile-skins"},Ie=["innerHTML"],Ee={class:"profile-skin"},He={class:"profile-skin-image"},Me=["srcset"],Ue=["src","alt"],Fe={class:"profile-skin-info"},Be={class:"profile-skin-title"},De=["innerHTML"],we={class:"profile-skin-status"},Oe=["innerHTML"],je={class:"profile-skin-button"},xe=["disabled"],Pe=["innerHTML"],Ve={class:"profile-skins-list"},Ke=["onClick"],Re={key:0,class:"is-locked-skin"},Ge={key:1,class:"is-current-skin"},qe=["srcset"],ze=["src","alt"],Xe=x({__name:"skins-list",setup(B){const f=re(),{$event:k,$listen:S,$stopListen:y}=_(),{t:p}=Y(),m=X(),n=z(),t=C(null),r=C([]),h=C(!1),v=C(!1);let b;const l=e=>{var s;return(e==null?void 0:e.id)==="skin0"?`/images/hamsters/${n.level??1}.webp`:(s=e==null?void 0:e.pictureLink)==null?void 0:s.compressedUrl},A=e=>{var s;return(e==null?void 0:e.id)==="skin0"?`/images/hamsters/${n.level??1}.png`:((s=e==null?void 0:e.pictureLink)==null?void 0:s.defaultUrl)??J},T=e=>{var s;return(e==null?void 0:e.id)===((s=n.skin)==null?void 0:s.selectedSkinId)},M=e=>{var s,a;return(a=(s=n.skin)==null?void 0:s.available)==null?void 0:a.some(I=>I.skinId===(e==null?void 0:e.id))},te=e=>{var s;return e.id===((s=t.value)==null?void 0:s.id)},H=(e,s=!1)=>{t.value=e,D(),v.value=!w.value,(t.value.isCurrent||!P.value&&!t.value.isAvailable)&&(v.value=!0),s&&(O().useHapticFeedback("soft"),N().trackEvent(`skin_click_${g.value}`))},D=()=>{var e;r.value=((e=m.skins)==null?void 0:e.map(s=>({...s,isAvailable:M(s),isCurrent:T(s),isSelected:te(s),isLocked:!M(s)})))??[]},ne=$(()=>{var e;return(e=t.value)!=null&&e.id?p(`profile.${t.value.id}_description`,{name:t.value.name}):""}),ie=()=>{const e=t.value?(r.value.findIndex(s=>{var a;return s.id===((a=t.value)==null?void 0:a.id)})-1+r.value.length)%r.value.length:r.value.length-1;H(r.value[e],!0)},oe=()=>{const e=t.value?(r.value.findIndex(s=>{var a;return s.id===((a=t.value)==null?void 0:a.id)})+1)%r.value.length:0;H(r.value[e],!0)},P=$(()=>{var e;return(((e=t.value)==null?void 0:e.price)??0)<=(n.balanceCoins??1)}),w=$(()=>{var e,s;return Number.isFinite((s=(e=t.value)==null?void 0:e.condition)==null?void 0:s.level)&&t.value.condition.level<=(n.level??1)}),V=$(()=>{var e,s;return Number.isFinite((s=(e=t.value)==null?void 0:e.condition)==null?void 0:s.level)&&t.value.condition.level>(n.level??1)}),le=$(()=>{var e,s,a,I;return w.value&&!((e=t.value)!=null&&e.isCurrent)&&!((s=t.value)!=null&&s.isAvailable)?p("buttons.unlock"):V.value?p("profile.locked_skin",{name:ue[((I=(a=t.value)==null?void 0:a.condition)==null?void 0:I.level)??1]}):p("buttons.choose")});D(),H(r.value.find(e=>{var s;return e.id===(((s=n.skin)==null?void 0:s.selectedSkinId)??"skin0")})??{id:"skin0",price:0,condition:{_type:"UserLevel",level:0}});const K=e=>{D();const s=r.value.find(a=>a.id===e.skin.id);s&&H(s)};de(()=>{y("buy-skin:success",K)}),_e(()=>{S("buy-skin:success",K)});const g=$(()=>{var e;return((e=t.value)==null?void 0:e.name)??"skin"}),ae=async()=>{var e;!v.value&&!h.value&&((e=t.value)!=null&&e.isAvailable?(h.value=!0,b=Z.promise({title:_().$i18n.t("messages.process_request")}),await n.postSkinSelect(t.value.id).then(()=>{O().useHapticFeedback("heavy"),N().trackEvent(`skin_choose_success_${g.value}`),b==null||b.resolve({title:_().$i18n.t("messages.success"),duration:3e3}),k("buy-skin:success",{skin:t.value}),setTimeout(()=>{ve(f(Q.GAME_INDEX))},400)}).catch(()=>{N().trackEvent(`skin_choose_error_${g.value}`),b==null||b.reject(_().$i18n.t("messages.no_select_skin",{name:g.value}))}).finally(()=>{setTimeout(()=>{h.value=!1},400)})):(N().trackEvent(`skin_buy_click_${g.value}`),k("bs:open",{component:ke(Ae),props:{skin:t.value}})))};return(e,s)=>{var R,G;const a=W,I=ee,ce=se;return c(),d("div",Te,[i("div",{class:"profile-skins-title",innerHTML:e.$t("profile.skin")},null,8,Ie),i("div",Ee,[i("div",He,[i("div",{class:"profile-skin-prev",onClick:ie},[L(a,{class:"is-flipped",name:"caret-right"})]),i("div",{class:"profile-skin-next",onClick:oe},[L(a,{name:"caret-right"})]),i("picture",null,[l(o(t))?(c(),d("source",{key:0,srcset:l(o(t)),type:"image/webp"},null,8,Me)):E("",!0),i("img",{class:"img-responsive",src:A(o(t)),alt:o(g)},null,8,Ue)])]),i("div",Fe,[i("div",Be,j(o(g)),1),i("div",{class:"profile-skin-description",innerHTML:o(ne)},null,8,De),i("div",we,[(R=o(t))!=null&&R.isAvailable?(c(),d("div",{key:0,class:"is-purchased",innerHTML:e.$t("profile.purchased")},null,8,Oe)):(c(),F(I,{key:1,price:((G=o(t))==null?void 0:G.price)??0,size:"large",class:U({"is-grayscale":!o(P)||o(V)}),round:!1},null,8,["price","class"]))]),i("div",je,[i("button",{class:U(["button button-default button-primary",{"is-disabled-blue":o(v)}]),onClick:ae,disabled:o(h)||o(v)},[o(h)?(c(),F(ce,{key:0})):(c(),d(q,{key:1},[i("span",{innerHTML:o(le)},null,8,Pe),o(w)&&!o(t).isAvailable?(c(),F(a,{key:0,name:"lock"})):E("",!0)],64))],10,xe)])])]),i("ul",Ve,[(c(!0),d(q,null,pe(o(r),u=>(c(),d("li",{key:u.id,class:U({"is-selected":u.isSelected,"is-locked":u.isLocked}),onClick:ls=>H(u,!0)},[u.isLocked?(c(),d("div",Re,[L(a,{name:"lock"})])):E("",!0),u.isCurrent?(c(),d("div",Ge,[L(a,{name:"check"})])):E("",!0),i("picture",null,[l(u)?(c(),d("source",{key:0,srcset:l(u),type:"image/webp"},null,8,qe)):E("",!0),i("img",{src:A(u),alt:(u==null?void 0:u.name)??"skin"},null,8,ze)]),i("p",null,j((u==null?void 0:u.name)??"skin"),1)],10,Ke))),128))])])}}}),Ye={class:"main"},Ze={class:"top-bar"},Je={class:"top-bar-center"},Qe=["innerHTML"],We=i("div",{class:"top-bar-right"},null,-1),es={class:"profile"},ss={class:"profile-header"},ts={class:"profile-header-user"},ns={class:"profile-header-user-avatar"},is=["srcset"],os=["src"],us=x({__name:"index",setup(B){var y,p;const f=me(),k=C(((y=f.account_avatar)==null?void 0:y.defaultUrl)??""),S=C(((p=f.account_avatar)==null?void 0:p.compressedUrl)??"");return k.value||(k.value=J),(m,n)=>{const t=W,r=he,h=Xe;return c(),d("main",Ye,[i("div",Ze,[L(r,{class:"top-bar-left",to:o(Q).GAME_INDEX},{default:fe(()=>[L(t,{class:"is-flipped is-24",name:"caret-right"})]),_:1},8,["to"]),i("div",Je,[i("p",{innerHTML:m.$t("profile.profile")},null,8,Qe)]),We]),i("div",es,[i("div",ss,[i("div",ts,[i("div",ns,[i("picture",null,[o(S)?(c(),d("source",{key:0,srcset:o(S),type:"image/webp"},null,8,is)):E("",!0),i("img",{src:o(k),onError:n[0]||(n[0]=v=>m.imageLoadError())},null,40,os)])]),i("p",null,j(o(f).account_name),1)])]),L(h)])])}}});export{us as default};
